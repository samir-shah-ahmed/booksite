<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookverse - Advanced Recommendation Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .book-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .form-input {
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .form-input:focus {
            border-color: #4f46e5; /* indigo-600 */
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.25);
            outline: none;
        }
        html { scroll-behavior: smooth; }
        #recommendation-engine-section {
            background: linear-gradient(to right, #1e3a8a, #312e81); /* dark blue to indigo */
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Ad placeholder styling */
        .ad-container {
            width: 300px; /* Standard ad width */
            height: 600px; /* Standard ad height */
            background-color: #e2e8f0; /* slate-200 */
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header & Navigation -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-slate-900">
                <i class="fas fa-brain mr-2 text-indigo-600"></i>Bookverse AI
            </a>
            <div class="flex items-center space-x-6">
                 <a href="#recommendation-engine-section" class="text-slate-600 hover:text-indigo-600 transition">Recommender</a>
            </div>
        </nav>
    </header>

    <!-- Main Content Wrapper -->
    <div class="container mx-auto px-6 py-16">
        <div class="flex flex-col lg:flex-row gap-12">

            <!-- Main Content Area -->
            <div class="w-full lg:w-2/3">
                <!-- Hero Section -->
                <main class="text-center mb-16">
                    <h1 class="text-4xl md:text-5xl font-bold text-slate-900 leading-tight">Smarter Book Recommendations</h1>
                    <p class="mt-4 text-lg text-slate-600 max-w-2xl mx-auto">Tell us a few books you love, and our AI-powered engine will discover your next great read from a library of millions of titles.</p>
                    <div class="mt-8">
                        <a href="#recommendation-engine-section" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-full hover:bg-indigo-700 transition transform hover:scale-105 inline-block">Get Started</a>
                    </div>
                </main>

                <!-- Recommendation Engine Section -->
                <section id="recommendation-engine-section" class="py-20 text-white rounded-lg">
                    <div class="container mx-auto px-6">
                        <h2 class="text-3xl font-bold text-center mb-4">Recommendation Engine</h2>
                        <p class="text-center text-indigo-200 mb-10 max-w-3xl mx-auto">Start by searching for 1-5 of your favorite books. The more books you add, the better the recommendations.</p>
                        
                        <div class="max-w-2xl mx-auto">
                            <!-- Search Input -->
                            <div class="relative">
                                <input type="text" id="book-search-input" class="form-input w-full py-3 px-4 rounded-lg text-slate-900" placeholder="Search for a book title..." autocomplete="off">
                                <div id="search-loader" class="absolute right-3 top-1/2 -translate-y-1/2 hidden"><div class="loader !w-6 !h-6 !border-2"></div></div>
                            </div>
                            <!-- Search Suggestions -->
                            <div id="search-suggestions" class="bg-white text-slate-800 rounded-lg mt-2 shadow-lg max-h-80 overflow-y-auto"></div>

                            <!-- Favorite Books List -->
                            <div id="favorite-books-section" class="mt-8">
                                <h3 class="text-xl font-semibold mb-4">Your Favorite Books:</h3>
                                <div id="favorite-books-list" class="grid grid-cols-1 gap-4">
                                    <p id="favorites-placeholder" class="text-indigo-200">Your selected books will appear here.</p>
                                </div>
                            </div>

                            <!-- Action Button -->
                            <div class="text-center mt-10">
                                <button id="get-recommendations-btn" class="bg-white text-indigo-600 font-bold py-3 px-12 rounded-full hover:bg-slate-100 transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    Find Recommendations
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Recommendations Results Section -->
                <section id="recommendations-results-section" class="py-16 hidden">
                    <div class="container mx-auto px-6">
                        <h2 class="text-3xl font-bold text-center mb-12">Here Are Your Custom Recommendations</h2>
                        <div id="recommendations-loader" class="flex justify-center hidden"><div class="loader"></div></div>
                        <div id="recommendations-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8"></div>
                        <p id="no-results-message" class="text-center text-slate-600 hidden">We couldn't find strong recommendations for that selection. Try adding more or different books.</p>
                    </div>
                </section>
            </div>

            <!-- Sidebar for Ads -->
            <aside class="w-full lg:w-1/3">
                <div class="sticky top-24">
                    <h3 class="font-bold text-lg mb-4 text-slate-700">Advertisement</h3>
                    <div class="ad-container flex items-center justify-center rounded-lg">
                        <!-- 
                          GOOGLE ADSENSE CODE GOES HERE 
                          
                          1. Sign up for Google AdSense.
                          2. Create a new ad unit.
                          3. Google will provide a <script> tag.
                          4. Paste that entire <script> tag here, replacing this comment block.
                        -->
                        <span class="text-slate-500">Ad Space (300x600)</span>
                    </div>
                </div>
            </aside>

        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white py-12 mt-16">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2024 Bookverse AI. All rights reserved.</p>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const searchInput = document.getElementById('book-search-input');
        const searchSuggestions = document.getElementById('search-suggestions');
        const searchLoader = document.getElementById('search-loader');
        const favoritesList = document.getElementById('favorite-books-list');
        const favoritesPlaceholder = document.getElementById('favorites-placeholder');
        const getRecsBtn = document.getElementById('get-recommendations-btn');
        const recsSection = document.getElementById('recommendations-results-section');
        const recsList = document.getElementById('recommendations-list');
        const recsLoader = document.getElementById('recommendations-loader');
        const noResultsMsg = document.getElementById('no-results-message');

        // --- State ---
        let favoriteBooks = [];
        let searchTimeout;
        let currentSearchController;

        // --- API & Core Logic ---

        /**
         * Debounces search input to prevent excessive API calls.
         */
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            const query = searchInput.value.trim();
            if (query.length < 3) {
                searchSuggestions.innerHTML = '';
                return;
            }
            searchLoader.classList.remove('hidden');
            searchTimeout = setTimeout(() => {
                searchBooks(query);
            }, 500);
        });

        /**
         * Searches for books using the Open Library API.
         * @param {string} query - The search term.
         */
        async function searchBooks(query) {
            if (currentSearchController) {
                currentSearchController.abort();
            }
            currentSearchController = new AbortController();
            const signal = currentSearchController.signal;

            try {
                const response = await fetch(`https://openlibrary.org/search.json?q=${encodeURIComponent(query)}&limit=5&fields=key,title,author_name,cover_i`, { signal });
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                displaySuggestions(data.docs);
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.error('Search failed:', error);
                    searchSuggestions.innerHTML = `<div class="p-3 text-red-500">Search failed. Please try again.</div>`;
                }
            } finally {
                searchLoader.classList.add('hidden');
            }
        }

        /**
         * Displays search suggestions.
         * @param {Array} books - Array of book objects from the API.
         */
        function displaySuggestions(books) {
            if (!books || books.length === 0) {
                searchSuggestions.innerHTML = `<div class="p-3">No results found.</div>`;
                return;
            }
            searchSuggestions.innerHTML = books.map(book => `
                <div class="p-3 flex items-center cursor-pointer hover:bg-slate-100" data-book-key="${book.key}">
                    <img src="${book.cover_i ? `https://covers.openlibrary.org/b/id/${book.cover_i}-S.jpg` : 'https://placehold.co/40x60/e2e8f0/64748b?text=N/A'}" alt="Cover" class="w-10 h-15 mr-4 object-cover">
                    <div>
                        <div class="font-bold">${book.title}</div>
                        <div class="text-sm text-slate-600">${book.author_name ? book.author_name.join(', ') : 'Unknown Author'}</div>
                    </div>
                </div>
            `).join('');
        }
        
        /**
         * Handles clicking on a search suggestion to add a book to favorites.
         */
        searchSuggestions.addEventListener('click', async (e) => {
            const suggestionDiv = e.target.closest('[data-book-key]');
            if (!suggestionDiv) return;

            const bookKey = suggestionDiv.dataset.bookKey;
            if (favoriteBooks.some(b => b.key === bookKey) || favoriteBooks.length >= 5) {
                if(favoriteBooks.length >= 5) alert('You can select a maximum of 5 books.');
                return;
            }

            searchInput.value = '';
            searchSuggestions.innerHTML = '';
            
            try {
                const response = await fetch(`https://openlibrary.org${bookKey}.json`);
                if (!response.ok) throw new Error('Failed to fetch book details');
                const bookDetails = await response.json();
                
                favoriteBooks.push({
                    key: bookDetails.key,
                    title: bookDetails.title,
                    subjects: bookDetails.subjects || [],
                    cover_i: bookDetails.covers ? bookDetails.covers[0] : null
                });
                
                renderFavoriteBooks();
            } catch (error) {
                console.error('Error adding book:', error);
                alert('Could not add book. Please try again.');
            }
        });

        /**
         * Renders the list of selected favorite books.
         */
        function renderFavoriteBooks() {
            if (favoriteBooks.length === 0) {
                favoritesList.innerHTML = '';
                favoritesList.appendChild(favoritesPlaceholder);
                favoritesPlaceholder.classList.remove('hidden');
                getRecsBtn.disabled = true;
            } else {
                favoritesPlaceholder.classList.add('hidden');
                favoritesList.innerHTML = favoriteBooks.map((book, index) => `
                    <div class="flex items-center justify-between bg-white/20 p-3 rounded-lg">
                        <span class="font-medium truncate pr-4">${book.title}</span>
                        <button class="text-white hover:text-red-400" onclick="removeFavorite(${index})">
                            <i class="fas fa-times-circle"></i>
                        </button>
                    </div>
                `).join('');
                getRecsBtn.disabled = false;
            }
        }
        
        /**
         * Removes a book from the favorites list.
         * @param {number} index - The index of the book to remove.
         */
        window.removeFavorite = (index) => {
            favoriteBooks.splice(index, 1);
            renderFavoriteBooks();
        }

        /**
         * Handles the click on "Find Recommendations" button.
         */
        getRecsBtn.addEventListener('click', async () => {
            if (favoriteBooks.length === 0) return;

            recsSection.classList.remove('hidden');
            recsList.innerHTML = '';
            noResultsMsg.classList.add('hidden');
            recsLoader.classList.remove('hidden');
            recsSection.scrollIntoView({ behavior: 'smooth' });

            const recommendations = await generateRecommendations();
            
            recsLoader.classList.add('hidden');
            if (recommendations.length > 0) {
                renderBookCards(recsList, recommendations);
            } else {
                noResultsMsg.classList.remove('hidden');
            }
        });
        
        /**
         * The core recommendation algorithm.
         * @returns {Promise<Array>} A promise that resolves to an array of recommended books.
         */
        async function generateRecommendations() {
            const subjectCounts = new Map();
            favoriteBooks.forEach(book => {
                // We only consider subjects with one or two words for better relevance
                const relevantSubjects = book.subjects.filter(s => s.split(' ').length <= 2);
                relevantSubjects.slice(0, 10).forEach(subject => { // Take top 10 subjects per book
                    subjectCounts.set(subject, (subjectCounts.get(subject) || 0) + 1);
                });
            });

            const sortedSubjects = [...subjectCounts.entries()].sort((a, b) => b[1] - a[1]);
            const topSubjects = sortedSubjects.slice(0, 3).map(s => s[0]);
            
            if (topSubjects.length === 0) return [];

            try {
                // Fetch books for each top subject and combine them
                const promises = topSubjects.map(subject => 
                    fetch(`https://openlibrary.org/subjects/${subject.toLowerCase().replace(/ /g, '_')}.json?limit=10`)
                    .then(res => res.json())
                );
                
                const results = await Promise.all(promises);
                const potentialRecs = new Map();
                
                results.forEach(subjectResult => {
                    if (subjectResult.works) {
                        subjectResult.works.forEach(work => {
                            // Ensure we don't recommend a book that's already a favorite
                            if (!favoriteBooks.some(fav => fav.key === work.key)) {
                                potentialRecs.set(work.key, work);
                            }
                        });
                    }
                });
                
                return Array.from(potentialRecs.values()).slice(0, 9); // Return up to 9 unique recommendations
            } catch (error) {
                console.error("Recommendation generation failed:", error);
                return [];
            }
        }
        
        /**
         * Renders book cards into a container.
         * @param {HTMLElement} container - The element to render into.
         * @param {Array} booksData - Array of book data from the API.
         */
        function renderBookCards(container, booksData) {
            container.innerHTML = booksData.map(book => {
                const bookCard = document.createElement('div');
                bookCard.className = 'book-card bg-white rounded-lg shadow-lg overflow-hidden flex flex-col';
                bookCard.innerHTML = `
                    <img src="${book.cover_id ? `https://covers.openlibrary.org/b/id/${book.cover_id}-L.jpg` : 'https://placehold.co/300x450/e2e8f0/64748b?text=No+Cover'}" alt="Cover of ${book.title}" class="w-full h-72 object-cover">
                    <div class="p-6 flex flex-col flex-grow">
                        <h3 class="text-xl font-bold mb-2 text-slate-900">${book.title}</h3>
                        <p class="text-slate-600 mb-4">by ${book.authors ? book.authors.map(a => a.name).join(', ') : 'Unknown Author'}</p>
                    </div>
                `;
                return bookCard.outerHTML;
            }).join('');
        }
    });
    </script>
</body>
</html>
